	.TITLE ARGS_BLINK
	.LIBRARY	/ARGSMAC/
	ARGSDEF	BLINK,<^X400>

	ARGSINPUT

ZMX:	.WORD	0
ZMY:	.WORD	0

	ARGSOUTPUT

CURX:	.WORD	0
CURY:	.WORD	0

	ARGSOUTEND

	ARGSINEND

	ARGSENTRY

	DEV.	TBR
	SETVV	ZMX,WORK
	ADDVV	ZMY,WORK
	SETVV	WORK,Z1+2
	SETVV	WORK,Z2+2

LOOP:
	DEV.	TBR
	SUBVV	TBR+2,CURX	; update x
	LDX	CURX		; restrict range
	JSE	CLAMP
	SUBVV	TBR+4,CURY	; update y
	LDX	CURY		; restrict range
	JSE	CLAMP
	SETVV	AUTO,WORK
	BRANZ	DIS1
	SETVV	TBR4,WORK
	ANDLV	<^X0010>,WORK
	BRAZE	NBUT1
DIS1:	ZDO	0
	ZPA	16
	.WORD	<^X0000>,<^X0101>,<^X0202>,<^X0303>
	.WORD	<^X0404>,<^X0505>,<^X0606>,<^X0707>
	.WORD	<^X0808>,<^X0909>,<^X0A0A>,<^X0B0B>
	.WORD	<^X0C0C>,<^X0D0D>,<^X0E0E>,<^X0F0F>
	SETVV	CURX,CS1+2
	XCL.	CS1
	SETVV	CURY,CS1+2
	YCL.	CS1
Z1:	ZOM	0,8,0,0
	DEL	0
	ZDO	255
DEL1:	DEL	0
	SETVV	AUTO,WORK
	BRANZ	DIS2
	JMR	LOOP
NBUT1:
	SETVV	TBR4,WORK
	ANDLV	<^X0020>,WORK
	BRAZE	NBUT2
DIS2:	ZDO	0
	ZPA	16
	.WORD	<^X0800>,<^X0901>,<^X0A02>,<^X0B03>
	.WORD	<^X0C04>,<^X0D05>,<^X0E06>,<^X0F07>
	.WORD	<^X0008>,<^X0109>,<^X020A>,<^X030B>
	.WORD	<^X040C>,<^X050D>,<^X060E>,<^X070F>
	XCL.	CS2
	YCL.	CS2
Z2:	ZOM	0,8,0,0
	DEL	0
	ZDO	255
DEL2:	DEL	0
	SETVV	AUTO,WORK
	BRANZ	AON
	JMR	LOOP
AON:
	SETVV	TBR4,WORK
	ANDLV	<^X0030>,WORK
	BRAZE	NBUT2
	SETLV	0,AUTO
	SETLV	0,DEL1+2
	SETLV	0,DEL2+2
	SETVV	TBR4,WORK
	ANDLV	<^X0010>,WORK
	BRAZE	DIS2
	JMR	DIS1
NBUT2:
	SETVV	TBR4,WORK
	ANDLV	<^X0008>,WORK
	BRAZE	NBUT4
	SETLV	1,AUTO
	SETVV	DEL1+2,WORK
	BRANZ	UPD
	ADDLV	1,DEL1+2
	ADDLV	1,DEL2+2
	JMR	NBUT4
UPD:
	ADDVV	DEL1+2,DEL1+2
	ADDVV	DEL2+2,DEL2+2
NBUT4:
	ANDLV	<^X0040>,TBR4
	BRAZE	LOOP
	ZPA	16
	.WORD	<^X0000>,<^X0101>,<^X0202>,<^X0303>
	.WORD	<^X0404>,<^X0505>,<^X0606>,<^X0707>
	.WORD	<^X0808>,<^X0909>,<^X0A0A>,<^X0B0B>
	.WORD	<^X0C0C>,<^X0D0D>,<^X0E0E>,<^X0F0F>
	ZDO	255
	STP

;  subroutine to keep x & y in range
;  enter with address of coordinate in index register
CLAMP:
	CMPLI	-1,0		; <-1?
	BRALT	10$		; yes
	SETLI	-1,0		; no: set to -1
	JMA	20$		; finished
10$:
	CMPLI	512,0		; >512?
	BRAGE	20$		; no: finished
	SETLI	512,0		; yes: set to 512
20$:
	RET	0		; return

TBR:	.WORD	<^X0044>,0,0
TBR4:	.WORD	0

WORK:	.WORD	0

CS1:	.WORD	0,0

CS2:	.WORD	0,256

AUTO:	.WORD	0


	ARGSEND	BLINK

	.END

